<?xml version="1.0" encoding="UTF-8"?>
<!-- Generated by Apache ServiceMix Archetype -->
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:osgi="http://camel.apache.org/schema/osgi"
	xmlns:osgix="http://www.springframework.org/schema/osgi-compendium"
	xmlns:ctx="http://www.springframework.org/schema/context"
	xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd
       http://camel.apache.org/schema/osgi http://camel.apache.org/schema/osgi/camel-osgi.xsd
       http://www.springframework.org/schema/osgi-compendium http://www.springframework.org/schema/osgi-compendium/spring-osgi-compendium.xsd
       http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

	<osgi:camelContext xmlns="http://camel.apache.org/schema/spring">
		<route>
			<from uri="file:///home/mfentanes/borrar/data?noop=true" />
			<convertBodyTo type="java.lang.String" />
			<to uri="jmstx:queue:giro" />
		</route>
		<route id="jms-transacted">
			<from uri="jmstx:queue:giro" />
			<to uri="jmstx:queue:credits" />
			<to uri="jmstx:queue:debits" />
			<bean ref="myTransform" method="transform" />
		</route>
		<route id="jdbc-transacted">
			<from uri="file:///home/mfentanes/borrar/data/transacted?noop=true" />
			<transacted/>
			<bean ref="cashService" method="insertTransaction" />
			<bean ref="cashService" method="insertNextTransaction" />
		</route>
	</osgi:camelContext>

	<!-- Custom beans configuration -->
	<bean id="myTransform" class="tutorial.MyTransform" />
	<bean id="cashService" class="tutorial.CashService" >
		<property name="dataSource" ref="dataSource" />
		
	</bean>
	<!-- Custom beans configuration -->


	<!-- JMS beans configuration transacted -->
	<bean id="jmstx" class="org.apache.camel.component.jms.JmsComponent">
		<property name="configuration" ref="jmsConfig" />
	</bean>
	<bean id="jmsConfig" class="org.apache.camel.component.jms.JmsConfiguration">
		<property name="connectionFactory" ref="jmsConnectionFactory" />
		<property name="transactionManager" ref="jmsTransactionManager" />
		<property name="transacted" value="true" />
	</bean>
	<bean id="jmsTransactionManager"
		class="org.springframework.jms.connection.JmsTransactionManager">
		<property name="connectionFactory" ref="jmsConnectionFactory" />
	</bean>
	<bean id="jmsConnectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory">
		<property name="brokerURL" value="tcp://localhost:61616" />
		<property name="userName" value="admin" />
		<property name="password" value="admin" />
	</bean>
	<!-- JMS beans configuration transacted -->


	<!-- Database beans transacted -->
	<bean id="txManager"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dataSource" />
	</bean>
	<bean id="PROPAGATION_REQUIRES_NEW" class="org.apache.camel.spring.spi.SpringTransactionPolicy">
		<property name="transactionManager" ref="txManager" />
		<property name="propagationBehaviorName" value="PROPAGATION_REQUIRES_NEW" />
	</bean>
	<bean id="PROPAGATION_REQUIRED" class="org.apache.camel.spring.spi.SpringTransactionPolicy">
		<property name="transactionManager" ref="txManager" />
		<property name="propagationBehaviorName" value="PROPAGATION_REQUIRED" />
	</bean>
	<bean id="dataSource"
		class="org.springframework.jdbc.datasource.SimpleDriverDataSource">
		<property name="driverClass" value="org.postgresql.Driver" />
		<property name="url" value="jdbc:postgresql://localhost/fuse" />
		<property name="username" value="fuse" />
		<property name="password" value="fuse" />
	</bean>
	<!-- Database beans transacted -->

</beans>
